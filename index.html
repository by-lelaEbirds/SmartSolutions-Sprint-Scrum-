<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conecta+ | Painel Kanban do Projeto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* --- DEFINIÇÃO DE VARIÁVEIS --- */
        :root {
            /* Tema Padrão: Modo Foco (Claro) */
            --bg-color: #FDFCFB;
            --column-bg: #F9FAFB;
            --card-bg: #FFFFFF;
            --text-color: #1a1a1a;
            --text-muted: #6b7280;
            --border-color: #E5E7EB;
            --accent-color: #7C3AED; /* Roxo do Conecta+ */
            --accent-glow: rgba(124, 58, 237, 0.4);
            --font-display: 'Poppins', sans-serif;
            --font-body: 'Poppins', sans-serif;
            --header-title-size: 32px;
            --header-title-shadow: none;
            --header-title-color: var(--accent-color);
            --transition-speed: 0.3s;
        }

        body.cosmic-mode {
            /* Tema Alternativo: Modo Cósmico (Escuro) */
            --bg-color: #0D0D1A;
            --column-bg: rgba(20, 20, 35, 0.5);
            --card-bg: rgba(20, 20, 35, 0.5);
            --text-color: #F0F0F5;
            --text-muted: #8A8A9E;
            --border-color: rgba(255, 255, 255, 0.1);
            --accent-color: #00F5D4; /* Verde-água do Conecta+ */
            --accent-glow: rgba(0, 245, 212, 0.5);
            --font-display: 'Orbitron', sans-serif;
            --header-title-size: 48px;
            --header-title-shadow: 0 0 10px var(--accent-glow), 0 0 20px var(--accent-glow);
            --header-title-color: var(--accent-color);
        }

        /* --- ANIMAÇÕES E ESTILOS GERAIS --- */
        @keyframes moveGradient { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes modal-in { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { font-family: var(--font-body); background-color: var(--bg-color); color: var(--text-color); transition: background-color var(--transition-speed), color var(--transition-speed); }

        .background-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, #1a0a2e, #0d0d1a, #0a1f2e); background-size: 400% 400%; animation: moveGradient 20s ease infinite; z-index: -1; opacity: 0; transition: opacity var(--transition-speed); }
        body.cosmic-mode .background-animation { opacity: 1; }

        .app-container { max-width: 1600px; margin: 0 auto; padding: 32px 40px; }

        /* --- CABEÇALHO E TEMAS --- */
        .main-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 32px; border-bottom: 1px solid var(--border-color); transition: border-color var(--transition-speed); }
        .header-left { display: flex; align-items: center; gap: 24px; }
        .header-title { font-family: var(--font-display); font-size: var(--header-title-size); font-weight: 900; color: var(--header-title-color); text-shadow: var(--header-title-shadow); transition: all var(--transition-speed) ease-in-out; }
        .theme-switcher button { background: var(--column-bg); border: 1px solid var(--border-color); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0; transition: all var(--transition-speed); }
        .theme-switcher svg { color: var(--text-muted); transition: all var(--transition-speed); }
        .theme-switcher button:hover { border-color: var(--accent-color); }
        .theme-switcher button:hover svg { color: var(--accent-color); }
        .theme-switcher .moon { display: none; }
        .theme-switcher .sun { display: block; }
        body.cosmic-mode .theme-switcher .moon { display: block; }
        body.cosmic-mode .theme-switcher .sun { display: none; }
        .add-task-button { display: inline-flex; align-items: center; gap: 10px; background-color: var(--accent-color); color: var(--bg-color); border: none; border-radius: 8px; padding: 12px 24px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease-out; }
        body.cosmic-mode .add-task-button { color: #000; }
        .add-task-button:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--accent-glow); }

        /* --- KANBAN E CARDS --- */
        .kanban-board { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 32px; padding-top: 32px; }
        .kanban-column { background: var(--column-bg); border: 1px solid var(--border-color); border-radius: 16px; display: flex; flex-direction: column; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); transition: all var(--transition-speed); }
        .column-header { padding: 16px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; transition: border-color var(--transition-speed); }
        .column-title h2 { font-size: 16px; font-weight: 600; letter-spacing: 1px; color: var(--text-color); transition: color var(--transition-speed); }
        .task-counter { background-color: var(--bg-color); color: var(--text-muted); font-size: 14px; font-weight: 600; padding: 4px 12px; border-radius: 20px; transition: all var(--transition-speed); }
        .tasks-container { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; gap: 20px; min-height: 250px; }
        .task-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; font-size: 16px; font-weight: 500; cursor: grab; transition: all 0.3s ease; position: relative; animation: fadeIn 0.5s ease-out forwards; animation-delay: var(--delay, 0ms); }
        .task-card:hover { transform: translateY(-5px); border-color: var(--accent-color); box-shadow: 0 0 15px var(--accent-glow); }
        .task-card.dragging { opacity: 0.1; transform: scale(1.02) rotate(3deg); }
        .ghost { height: 80px; background: rgba(124, 58, 237, 0.1); border: 2px dashed var(--accent-color); border-radius: 12px; }
        body.cosmic-mode .ghost { background: rgba(0, 245, 212, 0.1); }
        .delete-btn { position: absolute; top: 8px; right: 8px; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: var(--column-bg); border: 1px solid var(--border-color); color: var(--text-muted); font-size: 20px; cursor: pointer; border-radius: 50%; opacity: 0; transition: all 0.2s ease; }
        .task-card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { background-color: #FEE2E2; color: #EF4444; }
        body.cosmic-mode .delete-btn:hover { background-color: var(--accent-color); color: #000; }
        .task-card textarea { width: 100%; border: 1px solid var(--accent-color); border-radius: 8px; padding: 16px; font-family: inherit; font-size: 16px; resize: none; background-color: var(--bg-color); color: var(--text-color); }
        .empty-state { display: none; text-align: center; color: var(--text-muted); padding: 40px 20px; border: 2px dashed var(--border-color); border-radius: 12px; margin: auto 0; transition: all var(--transition-speed); }
        .empty-state.show { display: block; }

        /* --- MODAL --- */
        .modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: all 0.3s ease; z-index: 1000; }
        .modal-overlay.show { opacity: 1; visibility: visible; }
        .modal-content { background: var(--bg-color); border: 1px solid var(--border-color); padding: 32px 40px; border-radius: 16px; width: 90%; max-width: 550px; position: relative; animation: modal-in 0.3s ease-out forwards; transition: all var(--transition-speed); }
        body.cosmic-mode .modal-content { background: var(--column-bg); }
        .close-modal { position: absolute; top: 12px; right: 12px; background: none; border: none; font-size: 24px; line-height: 1; color: var(--text-muted); cursor: pointer; transition: color var(--transition-speed); }
        .close-modal:hover { color: var(--text-color); }
        .modal-content h2 { text-align: center; font-family: var(--font-display); font-size: 24px; color: var(--header-title-color); margin-bottom: 24px; letter-spacing: 1px; transition: color var(--transition-speed); }
        .modal-content textarea { width: 100%; height: 120px; background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; color: var(--text-color); font-family: inherit; font-size: 16px; resize: vertical; margin-bottom: 24px; transition: all var(--transition-speed); }
        body.cosmic-mode .modal-content textarea { background-color: rgba(0,0,0,0.2); }
        .modal-content textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-glow); }
        .modal-content button { width: 100%; padding: 16px; background-color: var(--accent-color); color: var(--bg-color); border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; letter-spacing: 1px; transition: all 0.2s ease-out; }
        body.cosmic-mode .modal-content button { color: #000; }
        .modal-content button:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--accent-glow); }
    </style>
</head>
<body>

    <div class="background-animation"></div>

    <div class="app-container">
        <header class="main-header">
            <div class="header-left">
                <h1 class="header-title">PROJETO CONECTA+</h1>
                <div class="theme-switcher">
                    <button id="themeToggle" title="Alternar Tema">
                        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    </button>
                </div>
            </div>
            <button id="addTaskBtn" class="add-task-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                <span>Nova Tarefa</span>
            </button>
        </header>

        <main class="kanban-board">
            <div class="kanban-column" id="todo">
                <div class="column-header">
                    <div class="column-title"><h2>A FAZER</h2></div>
                    <span class="task-counter">0</span>
                </div>
                <div class="tasks-container" data-column-id="todo">
                    <div class="empty-state"><p>Nenhuma tarefa pendente.</p></div>
                </div>
            </div>
            <div class="kanban-column" id="doing">
                <div class="column-header">
                    <div class="column-title"><h2>EM ANDAMENTO</h2></div>
                    <span class="task-counter">0</span>
                </div>
                <div class="tasks-container" data-column-id="doing">
                    <div class="empty-state"><p>Arraste uma tarefa aqui.</p></div>
                </div>
            </div>
            <div class="kanban-column" id="done">
                <div class="column-header">
                    <div class="column-title"><h2>CONCLUÍDO</h2></div>
                    <span class="task-counter">0</span>
                </div>
                <div class="tasks-container" data-column-id="done">
                    <div class="empty-state"><p>Nenhuma tarefa concluída.</p></div>
                </div>
            </div>
        </main>
    </div>

    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>CRIAR NOVA TAREFA</h2>
            <textarea id="taskInput" placeholder="Descreva a nova tarefa para o projeto Conecta+..."></textarea>
            <button id="saveTaskBtn">ADICIONAR</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ELEMENT SELECTORS ---
            const themeToggle = document.getElementById('themeToggle');
            const modal = document.getElementById('modal');
            const addTaskBtn = document.getElementById('addTaskBtn');
            const closeModalBtn = document.querySelector('.close-modal');
            const saveTaskBtn = document.getElementById('saveTaskBtn');
            const taskInput = document.getElementById('taskInput');
            const taskContainers = document.querySelectorAll('.tasks-container');

            // --- STATE ---
            let draggedItem = null, ghost = null;

            // --- THEME SWITCHER LOGIC ---
            const applyTheme = (theme) => {
                document.body.classList.toggle('cosmic-mode', theme === 'cosmic');
            };
            const toggleTheme = () => {
                const newTheme = document.body.classList.contains('cosmic-mode') ? 'light' : 'cosmic';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            };
            themeToggle.addEventListener('click', toggleTheme);

            // --- CORE & RENDER FUNCTIONS ---
            const renderBoard = () => {
                const state = loadState();
                Object.keys(state).forEach(columnId => {
                    const container = document.querySelector(`[data-column-id="${columnId}"]`);
                    if (!container) return;
                    [...container.children].forEach(child => { if (!child.classList.contains('empty-state')) container.removeChild(child); });
                    state[columnId].forEach((task, index) => {
                        const taskElement = createTaskElement(task);
                        taskElement.style.setProperty('--delay', `${index * 70}ms`);
                        container.appendChild(taskElement);
                    });
                });
                updateCountersAndEmptyStates();
            };

            const createTaskElement = (task) => {
                const element = document.createElement('div');
                element.classList.add('task-card');
                element.draggable = true;
                element.dataset.id = task.id;
                
                // Sanitiza o texto para evitar problemas de HTML
                const p = document.createElement('p');
                p.textContent = task.text;
                element.appendChild(p);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.classList.add('delete-btn');
                deleteBtn.innerHTML = '&times;';
                element.appendChild(deleteBtn);

                deleteBtn.addEventListener('click', () => deleteTask(task.id));
                addDragListeners(element);
                addEditListeners(element);
                return element;
            };

            const updateCountersAndEmptyStates = () => { document.querySelectorAll('.kanban-column').forEach(column => { const container = column.querySelector('.tasks-container'); const taskCount = container.querySelectorAll('.task-card').length; column.querySelector('.task-counter').textContent = taskCount; const emptyState = column.querySelector('.empty-state'); if(emptyState) emptyState.classList.toggle('show', taskCount === 0); }); };

            // --- EVENT HANDLERS ---
            const addDragListeners = (element) => {
                element.addEventListener('dragstart', e => { draggedItem = e.target; setTimeout(() => e.target.classList.add('dragging'), 0); });
                element.addEventListener('dragend', () => {
                    if (draggedItem) draggedItem.classList.remove('dragging');
                    draggedItem = null;
                    document.querySelectorAll('.ghost').forEach(g => g.remove());
                    ghost = null;
                    updateCountersAndEmptyStates(); 
                    saveState();
                });
            };
            const addEditListeners = (element) => { element.addEventListener('dblclick', () => { if (element.querySelector('textarea')) return; const p = element.querySelector('p'); p.style.display = 'none'; const currentText = p.textContent; const editInput = document.createElement('textarea'); editInput.value = currentText; element.appendChild(editInput); editInput.focus(); editInput.style.height = 'auto'; editInput.style.height = editInput.scrollHeight + 'px'; const saveChanges = () => { const newText = editInput.value.trim(); p.textContent = newText || currentText; p.style.display = 'block'; if(element.contains(editInput)) element.removeChild(editInput); updateTask(element.dataset.id, newText); }; editInput.addEventListener('blur', saveChanges); editInput.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); saveChanges(); } else if (e.key === 'Escape') { p.style.display = 'block'; if(element.contains(editInput)) element.removeChild(editInput); } }); }); };
            taskContainers.forEach(container => { container.addEventListener('dragover', e => { e.preventDefault(); const afterElement = getDragAfterElement(container, e.clientY); if (!ghost) { ghost = document.createElement('div'); ghost.classList.add('ghost'); } if (afterElement == null) container.appendChild(ghost); else container.insertBefore(ghost, afterElement); }); container.addEventListener('drop', e => { e.preventDefault(); if (draggedItem) e.currentTarget.insertBefore(draggedItem, ghost); }); });
            const getDragAfterElement = (container, y) => { const draggableElements = [...container.querySelectorAll('.task-card:not(.dragging)')]; return draggableElements.reduce((closest, child) => { const box = child.getBoundingClientRect(); const offset = y - box.top - box.height / 2; if (offset < 0 && offset > closest.offset) return { offset: offset, element: child }; else return closest; }, { offset: Number.NEGATIVE_INFINITY }).element; };

            // --- ACTIONS ---
            const addTask = () => { const text = taskInput.value.trim(); if (!text) return; let state = loadState(); const newTask = { id: `task-${Date.now()}`, text: text }; state.todo.unshift(newTask); saveAndRerender(state); closeModal(); };
            const deleteTask = (taskId) => { let state = loadState(); for (const columnId in state) state[columnId] = state[columnId].filter(task => task.id !== taskId); saveAndRerender(state); };
            const updateTask = (taskId, newText) => { let state = loadState(); for (const columnId in state) { const task = state[columnId].find(task => task.id === taskId); if (task) { task.text = newText; break; } } saveState(state); };

            // --- LOCAL STORAGE & STATE MANAGEMENT ---
            const saveState = (state = null) => { if (!state) { state = { todo: [], doing: [], done: [] }; taskContainers.forEach(container => { const columnId = container.dataset.columnId; if (!state[columnId]) state[columnId] = []; container.querySelectorAll('.task-card').forEach(card => { state[columnId].push({ id: card.dataset.id, text: card.querySelector('p').textContent }); }); }); } localStorage.setItem('kanbanStateConecta', JSON.stringify(state)); };
            const loadState = () => {
                const savedState = localStorage.getItem('kanbanStateConecta');
                // --- TAREFAS DO PROJETO CONECTA+ ---
                const defaultState = {
                    todo: [
                        { id: `task-conecta-1`, text: "Implementar badges de conquistas no perfil do prestador" },
                        { id: `task-conecta-2`, text: "Criar dashboard do prestador para ver novos pedidos" },
                        { id: `task-conecta-3`, text: "Ajustar responsividade da plataforma para tablets" },
                        { id: `task-conecta-4`, text: "Testar fluxo de avaliação em múltiplos navegadores (QA)" },
                        { id: `task-conecta-5`, text: "[V2.0] Desenvolver algoritmo de 'match' inteligente" },
                        { id: `task-conecta-6`, text: "[BACKLOG] Integração com Login Social (Google)" }
                    ],
                    doing: [
                        { id: `task-conecta-7`, text: "Finalizar fluxo de 'Novo Pedido' com upload de imagens" },
                        { id: `task-conecta-8`, text: "Desenvolver sistema de avaliação com nota e comentário" },
                        { id: `task-conecta-9`, text: "Implementar tema claro/escuro (Dark Mode)" }
                    ],
                    done: [
                        { id: `task-conecta-10`, text: "Criar sistema de Login e Autenticação (front-end)" },
                        { id: `task-conecta-11`, text: "Desenvolver página de perfil do prestador (estática)" },
                        { id: `task-conecta-12`, text: "Criar dashboard do cliente para visualização de pedidos" },
                        { id: `task-conecta-13`, text: "Desenvolver página 'Encontrar Prestadores'" },
                        { id: `task-conecta-14`, text: "Estruturar o projeto (HTML base, CSS, JS)" }
                    ]
                };
                const state = savedState ? JSON.parse(savedState) : defaultState;
                if (!savedState) saveState(state);
                return state; 
            };
            const saveAndRerender = (state) => { saveState(state); renderBoard(); };

            // --- MODAL ---
            const openModal = () => modal.classList.add('show');
            const closeModal = () => { modal.classList.remove('show'); taskInput.value = ''; };

            // --- INITIALIZATION ---
            addTaskBtn.addEventListener('click', openModal);
            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', e => (e.target === modal) && closeModal());
            saveTaskBtn.addEventListener('click', addTask);
            
            const savedTheme = localStorage.getItem('theme') || 'cosmic';
            applyTheme(savedTheme);
            
            renderBoard();
        });
    </script>
</body>
</html>
